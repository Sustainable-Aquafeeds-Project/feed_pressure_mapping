---
title: "Allocate_crop_demand"
author: "Rich Cottrell"
date: "19/04/2022"
output: html_document
---

```{r}
library(tidyverse)
library(here)
library(raster)

source(here("src/directories.R"))

select <- dplyr::select

```


Get the mapspam codes of interest from the demand calculations and import the rasters into the project
```{r}

crop_demand <- readRDS(here("data/tidy_data/demand/total_crop_demand.rds"))

crop_list <- unique(crop_demand$map_spam_code)

mclapply(X=crop_list, FUN =  \(this_code){
  #identify all files for each crop
  these_crop_files <- list.files(file.path(mapspam_dir, "new-extents"), pattern = sprintf("_%s_", toupper(this_code)), full.names = TRUE)
  these_crop_filenames <- list.files(file.path(mapspam_dir, "new-extents"), pattern = sprintf("_%s_", toupper(this_code)))
  map2(.x = these_crop_files, .y = these_crop_filenames, .f = \(this_file, this_filename){
    #import the raster
    imported_file <- raster(this_file)
    writeRaster(imported_file, filename = paste0(here("data/spatial/crop-layers-raw/"), this_filename), overwrite=TRUE)})
  },
  mc.cores = 7
)


```

We're intetrested in the impacts of different diets depending on their make-up and where they are sourced from so probably organise the spatial outputs by diet
```{r}
unique(crop_demand$diet)

```

