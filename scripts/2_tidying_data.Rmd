---
title: "Tidying data"
author: "Rich Cottrell"
date: "15/02/2022"
output: html_document
---

```{r}
library(tidyverse)
library(parallel)
library(raster)
library(janitor)
library(here)
library(rredlist)

source(here("src/directories.R"))
```


This is the code to unzip and adjust the extents of the mapspam rasters (-180, 180, -90, 90) - DO NOT RUN IN PROJECT - here as a backup to scripts in the raw data files

```{r}


mapspam_zip_files <- list.files(path = mapspam_dir, pattern = "\\.zip$")


lapply(X=mapspam_zip_files, FUN = unzip)


#Adjust the extent of rasters to full lon lat coveragge

#test
banana <- raster(file.path(mapspam_dir, "spam2010V2r0_global_H_BANA_H.tif"))
banana

#this should be the new extent for all
new_extent <- c(-180, 180, -90, 90)

extent(banana) <- new_extent

#apply new extents to all files

tifs <- list.files(dir, pattern = "\\.tif")

adjust_extent <- function(this_file){
  message(paste("processing", which(tifs==this_file), "of", length(tifs)))
  this_raster <- raster(this_file)
  extent(this_raster) <- new_extent
  writeRaster(x=this_raster, filename = file.path("/mnt/rdsi/raw_data/MAPSPAM/new-extents", this_file), overwrite = TRUE)
}

#run over mutliple cores to speed things up
parallel::mclapply(X = tifs, FUN = adjust_extent, mc.cores = 6)


```

This is the code to unzip the gridded livestock of the world rasters - DO NOT RUN IN PROJECT - here as a backup to scripts in the raw data files

```{r}

dir <- "/mnt/rdsi/raw_data/gridded-livestock-of-the-world"

setwd(dir)

library(tidyverse)
library(parallel)
library(raster)

glw_zip_files <- list.files(dir, pattern = "\\.zip$")

unzip_raw_data <- function(this_file){
  this_file_name <- file.path(dir, this_file)
  unzip(this_file_name)
  
}


lapply(X = glw_zip_files, FUN = unzip_raw_data)



```


