---
title: "Tidying data"
author: "Rich Cottrell"
date: "15/02/2022"
output: html_document
---

```{r}
library(tidyverse)
library(parallel)
library(raster)
library(janitor)
library(here)

source(here("src/directories.R"))
```


```{r}


zip_files <- list.files(path = mapspam_dir, pattern = "\\.zip$")


lapply(X=zip_files, FUN = unzip)



#Adjust the extent of rasters to full lon lat coveragge

#test
banana <- raster(file.path(mapspam_dir, "spam2010V2r0_global_H_BANA_H.tif"))
banana

#this should be the new extent for all
new_extent <- c(-180, 180, -90, 90)

extent(banana) <- new_extent

#apply new extents to all files

tifs <- list.files(dir, pattern = "\\.tif")

adjust_extent <- function(this_file){
  message(paste("processing", which(tifs==this_file), "of", length(tifs)))
  this_raster <- raster(this_file)
  extent(this_raster) <- new_extent
  writeRaster(x=this_raster, filename = file.path("/mnt/rdsi/raw_data/MAPSPAM/new-extents", this_file), overwrite = TRUE)
}

#run over mutliple cores to speed things up
parallel::mclapply(X = tifs, FUN = adjust_extent, mc.cores = 6)


```

